<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Merry Christmas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #050505; /* æ·±é»‘èƒŒæ™¯è¡¬æ‰˜å‘å…‰ */
            font-family: 'Mountains of Christmas', cursive;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* UI å±‚ */
        .ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ° Canvasï¼Œé™¤éç‚¹åœ¨æŒ‰é’®ä¸Š */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .greeting-box {
            margin-top: 10vh;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            animation: float 4s ease-in-out infinite;
        }

        .greeting {
            color: #fff;
            font-size: 4rem;
            margin: 0;
            background: linear-gradient(to bottom, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sub-greeting {
            color: #e0e0e0;
            font-size: 2rem;
            margin-top: 10px;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .tap-hint {
            position: absolute;
            bottom: 50px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }

        /* ç¥ç¦è¯­é®ç½©å±‚ */
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease;
            backdrop-filter: blur(8px);
        }

        .message-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .message-card {
            background: linear-gradient(135deg, #1a1a1a, #2c3e50);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
            text-align: center;
            max-width: 80%;
            transform: scale(0.8);
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .message-overlay.active .message-card {
            transform: scale(1);
        }

        .message-text {
            color: #fff;
            font-size: 1.8rem;
            line-height: 1.6;
        }

        .close-hint {
            margin-top: 20px;
            font-size: 1rem;
            color: #888;
            cursor: pointer;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .greeting { font-size: 3rem; }
            .sub-greeting { font-size: 1.5rem; }
            .message-text { font-size: 1.4rem; }
            .message-card { padding: 25px; width: 85%; }
        }
    </style>
    <!-- å¼•å…¥ Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
</head>
<body>

    <div id="canvas-container"></div>

    <div class="ui-container">
        <div class="greeting-box">
            <h1 class="greeting">Merry Christmas</h1>
            <div class="sub-greeting">To: å°æ˜Ÿâ­</div>
        </div>
        <div class="tap-hint">(Tap screen for a surprise)</div>
    </div>

    <div class="message-overlay" id="message-overlay">
        <div class="message-card">
            <div class="message-text">
                May the Christmas season bring only happiness and joy to you and your family.<br><br>
                Wishing you peace, love, and joy this Christmas and throughout 2026.<br><br>
                Merry Christmas! ğŸ„âœ¨
            </div>
            <div class="close-hint">Tap to close</div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- åˆå§‹åŒ–åœºæ™¯ ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // æ·»åŠ ä¸€ç‚¹è¿·é›¾ï¼Œå¢åŠ æ·±é‚ƒæ„Ÿ
        scene.fog = new THREE.FogExp2(0x050505, 0.02);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 3, 12); // ç›¸æœºä½ç½®
        camera.lookAt(0, 2, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // ä¼˜åŒ–ç§»åŠ¨ç«¯æ€§èƒ½
        container.appendChild(renderer.domElement);

        // --- ç¯å…‰ç³»ç»Ÿ ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        // ä¸»å…‰æº - æš–è‰²è°ƒ
        const pointLight = new THREE.PointLight(0xffd700, 1.5, 50);
        pointLight.position.set(5, 10, 5);
        scene.add(pointLight);

        // è¡¥å…‰ - å†·è‰²è°ƒ
        const blueLight = new THREE.PointLight(0x0044ff, 1, 30);
        blueLight.position.set(-5, 5, -5);
        scene.add(blueLight);

        // --- æ„å»º 3D åœ£è¯æ ‘ ---
        const treeGroup = new THREE.Group();
        scene.add(treeGroup);

        // 1. æ ‘å¶ (å±‚å åœ†é”¥ä½“)
        const leavesMaterial = new THREE.MeshStandardMaterial({
            color: 0x0f5e28,
            roughness: 0.8,
            metalness: 0.2,
            flatShading: true // ä½å¤šè¾¹å½¢é£æ ¼ï¼Œæ›´æœ‰æ£±è§’æ„Ÿ
        });

        const levels = 5;
        for (let i = 0; i < levels; i++) {
            const radius = 3.5 - i * 0.6;
            const height = 2.5;
            const y = i * 1.8;

            const geometry = new THREE.ConeGeometry(radius, height, 8); // 8è¾¹å½¢ï¼Œæ¯”è¾ƒç«‹ä½“
            const cone = new THREE.Mesh(geometry, leavesMaterial);
            cone.position.y = y + 1;
            cone.castShadow = true;
            cone.receiveShadow = true;
            treeGroup.add(cone);

            // 2. è£…é¥°å½©ç¯ (æ¯å±‚è¾¹ç¼˜)
            const ornamentCount = 6 + i * 2; // ä¸‹é¢å¤šï¼Œä¸Šé¢å°‘
            for (let j = 0; j < ornamentCount; j++) {
                const angle = (j / ornamentCount) * Math.PI * 2;
                const r = radius - 0.2; // ç¨å¾®å¾€é‡Œä¸€ç‚¹

                // éšæœºé¢œè‰²ï¼šçº¢ã€é‡‘ã€è“
                const colors = [0xff0000, 0xffd700, 0x0088ff];
                const color = colors[Math.floor(Math.random() * colors.length)];

                const bulbGeo = new THREE.SphereGeometry(0.15, 16, 16);
                const bulbMat = new THREE.MeshStandardMaterial({
                    color: color,
                    emissive: color, // è‡ªå‘å…‰
                    emissiveIntensity: 0.8,
                    metalness: 0.9,
                    roughness: 0.1
                });

                const bulb = new THREE.Mesh(bulbGeo, bulbMat);
                // è®¡ç®—åœ†é”¥åº•éƒ¨çš„è¾¹ç¼˜ä½ç½®
                bulb.position.set(
                    Math.cos(angle) * r,
                    y - height/2 + 1 + 0.1, // æŒ‚åœ¨æ¯å±‚åº•éƒ¨è¾¹ç¼˜
                    Math.sin(angle) * r
                );

                // ç»™å½©ç¯æ·»åŠ è‡ªå®šä¹‰å±æ€§ç”¨äºåŠ¨ç”»
                bulb.userData = {
                    phase: Math.random() * Math.PI * 2,
                    speed: 2 + Math.random() * 2
                };

                treeGroup.add(bulb);
            }
        }

        // 3. æ ‘å¹²
        const trunkGeo = new THREE.CylinderGeometry(0.6, 0.8, 2, 8);
        const trunkMat = new THREE.MeshStandardMaterial({ color: 0x5e3a18, roughness: 0.9 });
        const trunk = new THREE.Mesh(trunkGeo, trunkMat);
        trunk.position.y = 0;
        treeGroup.add(trunk);

        // 4. é¡¶éƒ¨æ˜Ÿæ˜Ÿ
        const starGeo = new THREE.OctahedronGeometry(0.6, 0);
        const starMat = new THREE.MeshStandardMaterial({
            color: 0xffd700,
            emissive: 0xffd700,
            emissiveIntensity: 1.5,
            metalness: 1,
            roughness: 0
        });
        const star = new THREE.Mesh(starGeo, starMat);
        star.position.y = levels * 1.8 + 0.5;
        treeGroup.add(star);

        // 5. åœ°é¢ (åå…‰é›ªåœ°)
        const groundGeo = new THREE.CircleGeometry(15, 32);
        const groundMat = new THREE.MeshStandardMaterial({
            color: 0xffffff,
            roughness: 0.3,
            metalness: 0.1
        });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -1;
        scene.add(ground);

        // --- ç²’å­é›ªèŠ±ç³»ç»Ÿ ---
        const snowCount = 1000;
        const snowGeo = new THREE.BufferGeometry();
        const snowPos = [];
        const snowVelocities = [];

        for(let i=0; i<snowCount; i++) {
            snowPos.push(
                (Math.random() - 0.5) * 30, // x
                (Math.random() - 0.5) * 30 + 10, // y (start high)
                (Math.random() - 0.5) * 30  // z
            );
            snowVelocities.push(
                (Math.random() - 0.5) * 0.05, // vx
                -(Math.random() * 0.05 + 0.02), // vy (down)
                (Math.random() - 0.5) * 0.05 // vz
            );
        }

        snowGeo.setAttribute('position', new THREE.Float32BufferAttribute(snowPos, 3));
        const snowMat = new THREE.PointsMaterial({
            color: 0xffffff,
            size: 0.15,
            transparent: true,
            opacity: 0.8
        });
        const snowSystem = new THREE.Points(snowGeo, snowMat);
        scene.add(snowSystem);

        // --- åŠ¨ç”»å¾ªç¯ ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // 1. æ ‘æ—‹è½¬
            treeGroup.rotation.y = Math.sin(time * 0.2) * 0.3; // ç¼“æ…¢å·¦å³æ‘‡æ‘†

            // 2. æ˜Ÿæ˜Ÿè‡ªè½¬
            star.rotation.y = time * 0.5;
            star.scale.setScalar(1 + Math.sin(time * 3) * 0.1); // å‘¼å¸æ•ˆæœ

            // 3. å½©ç¯é—ªçƒ
            treeGroup.children.forEach(child => {
                if (child.geometry.type === 'SphereGeometry') { // æ‰¾åˆ°å½©ç¯
                    const intensity = 0.5 + Math.sin(time * child.userData.speed + child.userData.phase) * 0.5;
                    child.material.emissiveIntensity = intensity > 0 ? intensity : 0.1;
                }
            });

            // 4. é›ªèŠ±é£˜è½
            const positions = snowSystem.geometry.attributes.position.array;
            for(let i=0; i<snowCount; i++) {
                // Update y
                positions[i*3 + 1] += snowVelocities[i]; // y
                positions[i*3] += Math.sin(time + i) * 0.01; // x sway

                // Reset if below ground
                if(positions[i*3 + 1] < -1) {
                    positions[i*3 + 1] = 15;
                }
            }
            snowSystem.geometry.attributes.position.needsUpdate = true;

            renderer.render(scene, camera);
        }

        animate();

        // --- äº¤äº’é€»è¾‘ ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ç‚¹å‡»äº‹ä»¶
        const overlay = document.getElementById('message-overlay');

        // ç‚¹å‡»å±å¹•ä»»æ„ä½ç½® (é™¤äº† overlay å†…éƒ¨)
        document.addEventListener('click', (e) => {
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯ overlay å†…éƒ¨çš„å†…å®¹ï¼Œåˆ™æ˜¾ç¤º overlay
            if (!overlay.contains(e.target) && !overlay.classList.contains('active')) {
                overlay.classList.add('active');
            }
        });

        // ç‚¹å‡» overlay å…³é—­
        overlay.addEventListener('click', () => {
            overlay.classList.remove('active');
        });

    </script>
</body>
</html>